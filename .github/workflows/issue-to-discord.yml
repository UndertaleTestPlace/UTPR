name: "Issue â†’ Discord (with comments)"

on:
  issues:
    types: [opened, edited, closed, reopened, labeled, unlabeled]
  issue_comment:
    types: [created, edited, deleted]
  workflow_dispatch: {}

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send to Discord
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          DISCORD_EMBEDS: |
            [{
              "title": "${{ github.event_name == 'issue_comment' && 'Comment on: ' || 'Issue: ' }}${{ github.event.issue.title }}",
              "url": "${{ github.event_name == 'issue_comment' && github.event.comment.html_url || github.event.issue.html_url }}",
              "description": "${{ github.event_name == 'issue_comment' && github.event.comment.body || github.event.action }}",
              "fields": [
                {
                  "name": "By",
                  "value": "${{ github.event_name == 'issue_comment' && github.event.comment.user.login || github.event.actor }}",
                  "inline": true
                },
                {
                  "name": "State",
                  "value": "${{ github.event.issue.state }}",
                  "inline": true
                },
                {
                  "name": "Status",
                  "value": "${{ join(github.event.issue.labels.*.name, ', ') }}",
                  "inline": true
                }
              ]
            }]
